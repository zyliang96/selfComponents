# 2022 年 2 月 23 日

## 1、第一题

```javascript
// 实现add函数，完成以下功能
// add(1,2)(3).count() // 输出 4
// add(1)(2,3)(4).count() //输出12
function add() {}
```

具体实现如下：

```javascript
function add(...arg) {
	let sum = 0;
	for (let i of arg) {
		sum += i;
	}
	let func = function (...props) {
		for (let i of props) {
			sum += i;
		}
		return func;
	};

	func.toString = function () {
		return sum;
	};

	func.valueOf = function () {
		console.log('valueOf');
		return sum;
	};

	func.count = function () {
		return sum;
	};
	return func;
}
```

## 2、第二题

```javascript
// 实现一个异步任务调度类，该类有一个实例方法push,push入参为一个异步函数。push返回一个promise。promise的状态和传入的异步函数执行状态同步
// 要求只能同时进行10个异步任务

class Scheduler {
	push() {}
}
```

具体实现如下

```javascript

function isPromise(anything){
      return anything && typeof anything.then === 'function';
}

class Scheduler {
	taskList = [];
	push(func) {
        if(!isPromise(func)){
            func = func()
        }
		if (this.taskList.length >= 10) {
			return Promise.resolve('只能放10个异步任务');
		}
		const task = new Promise((resolve, reject) => {
            
			func.then(
				(res) => {
					resolve(res);
					this.taskList = this.taskList.filter((item) => item !== task);
				},
				(res) => {
					reject(res);
					this.taskList = this.taskList.filter((item) => item !== task);
				}
			);
		});
		this.taskList.push(task);
		return task;
	}
}
const SchedulerInterface = new Scheduler();

for (let i = 0; i < 11; i++) {
	// const func = new Promise((resolve, reject) => {
	// 	let result = Math.random() >= 0.5;
	// 	setTimeout(() => {
	// 		if (result) {
	// 			resolve(result);
	// 		} else {
	// 			reject(result);
	// 		}
	// 	}, i * 500);
	// });

	const func = async () => {
		let result = Math.random() >= 0.5;
		if (!result) {
			throw '111';
		}
	};
	SchedulerInterface.push(func).then(
		(res) => {
			console.log('resolve', i, res);
		},
		(error) => {
			console.log('reject', i, error);
		}
	);
}

setTimeout(() => {
	const func = new Promise((resolve, reject) => {
		let result = Math.random() >= 0.5;
		setTimeout(() => {
			if (result) {
				resolve(result);
			} else {
				reject(result);
			}
		}, 1500);
	});
	SchedulerInterface.push(func).then(
		(res) => {
			console.log('resolve other', res);
		},
		(error) => {
			console.log('reject other', error);
		}
	);
}, 0);
```



```javascript

```