# 4 月 15 日题目

## 一、Node 如何和 MySQL 进行通信?

可以借助一些 sql 相关模块实现 node 和 mysql 数据库的通行，这里以 mysql2 模块为例，代码如下：
第一步：安装 mysql2 模块

```js
npm install --save mysql2
```

第二步：连接数据库

```js
const mysql = require("mysql2");
//引入 mysql2 模块
const connection = mysql.createConnection({
	host: "localhost", //主机地址
	user: "root", // 数据库用户名
	database: "test", //数据库名称
});
```

第三步：通过 query 来执行 sql 语句 ，如下：

```js
connection.query(
	'SELECT * FROM `table` WHERE `name` = "Page" AND `age` > 45',
	function (err, results, fields) {
		console.log(results); // 查询到的结果
		console.log(fields); // 获取字段的相关信息
	}
);
```

## 二、浏览器为什么要阻止跨域请求？如何解决跨域？每次跨域请求都需要到达服务端吗？（快手）

浏览器阻止跨域请求的原因是”同源策略“，”同源策略“主要解决的问题是浏览器的安全问题，同源是 如果两个 URL 的协议、域名和端口都相同，我们就称这两个 URL 同源。，非同源是只要协议、域名、端口有一个不同就会造成非同源。如下：

```
  http://www.kaikeba.com:443   //http:协议
  www.kaikeba.com:域名  443：端口  http://www.kaikeba.com:3000
```

同源策略的三个表现层面：

- DOM 层面
  同源策略限制了来自不同源的 JavaScript 脚本对当前 DOM 对象读和写的操作。我们从第一个页面打开同源的第二个页面，然后在第二个页面中操作，对象 opener 就是指向第一个页面的 window 对象，我们可以通过操作 opener 来控制第一个页面中的 DOM
- 数据层面
  同源策略限制了不同源的站点读取当前站点的 Cookie、IndexDB、LocalStorage 等数据。
- 网络层面
  同源策略限制了通过 XMLHttpRequest 等方式将站点的数据发送给不同源的站点。

同源策略可以隔离各个站点之间的 DOM 交互、页面数据和网络通信，虽然严格的同源策略会带来更多的安全，但是也束缚了 Web。这就需要在安全和自由之间找到一个平衡点，所以我们默认页面中可以引用任意第三方资源，然后又引入 CSP 策略来加以限制；默认 XMLHttpRequest 和 Fetch 不能跨站请求资源，然后又通过 CORS 策略来支持其跨域。

![同源策略](/images/同源策略.png)

如上两地址由于端口不同就造成跨域问题。

非同源会造成：
1.无法获取 cookie、localstroage、indexedDB。
2.无法访问网页中 dom。
3 无法发送网络请求。

所以浏览器阻止跨域的原因是基于网络安全考虑。解决跨域方式有很多种例如：
1.jsonp 跨域。
2、postMessage 解决跨域
3、跨域资源共享（CORS）
4.nginx 反向代理
5.nodejs 中间件正向代理
7websocket 协议跨域。
跨域是浏览器出于安全策略阻止非同源请求，但是每次跨域请求其实都是正常发送的，服务端也会正常返回，只是被浏览器拦截起来了。所以每次跨域请求都会到达服务端。
